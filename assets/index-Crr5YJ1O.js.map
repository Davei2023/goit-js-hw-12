{"version":3,"file":"index-Crr5YJ1O.js","sources":["../../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\n// --------- refs ---------\nconst refs = {\n  form: document.querySelector('.form'),\n  input: document.querySelector('.search-inp'),\n  searchBtn: document.querySelector('.search-btn'),\n  gallery: document.querySelector('.gallery'),\n  loadMoreBtn: document.querySelector('.load-btn'),\n  loader: document.querySelector('.loader-container'),\n};\n\n// --------- api ---------\nconst PER_PAGE = 15;\nconst API_KEY = '42030436-f44bf17f2fc4b636ae2b8b7a9';\n\nconst api = axios.create({\n  baseURL: 'https://pixabay.com/api/',\n  timeout: 10000,\n  params: {\n    key: API_KEY,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: PER_PAGE,\n  },\n});\n\nasync function getImages(q, page = 1) {\n  const { data } = await api.get('', { params: { q, page } });\n  return data; // { total, totalHits, hits }\n}\n\n// --------- state ---------\nlet page = 1;\nlet query = '';\nlet maxPage = 0;\nlet isLoading = false;\n\n// --------- lightbox ---------\nconst lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\n// --------- listeners ---------\nrefs.form.addEventListener('submit', onSearch);\nrefs.loadMoreBtn.addEventListener('click', onLoadMore);\n\n// --------- handlers ---------\nasync function onSearch(e) {\n  e.preventDefault();\n  const q = refs.input.value.trim();\n\n  if (!q) return toast(`The search field can't be empty! Please, enter your request!`);\n  if (q.length > 100) return toast('Search query must be 100 characters or less.');\n\n  // reset\n  query = q;\n  page = 1;\n  refs.gallery.innerHTML = '';\n  hideLoadMore();\n  showLoader();\n\n  try {\n    const { hits, totalHits } = await getImages(query, page);\n    maxPage = Math.ceil((totalHits || 0) / PER_PAGE);\n\n    if (!hits?.length) {\n      toast(`Sorry, there are no images matching your search query. Please, try again!`);\n      return;\n    }\n\n    appendMarkup(hits);\n    if (page < maxPage) showLoadMore();\n  } catch (err) {\n    console.error(err);\n    toast('Something went wrong. Please, try again later.');\n  } finally {\n    hideLoader();\n    refs.form.reset();\n  }\n}\n\nasync function onLoadMore() {\n  if (isLoading) return;\n  if (page >= maxPage) return endOfResults();\n\n  isLoading = true;\n  showLoader();\n  refs.loadMoreBtn.disabled = true;\n\n  try {\n    page += 1;\n    const { hits } = await getImages(query, page);\n    if (!hits?.length) return endOfResults();\n\n    appendMarkup(hits);\n    smoothScrollByCard();\n\n    if (page >= maxPage) endOfResults();\n  } catch (err) {\n    console.error(err);\n    toast('Something went wrong. Please, try again later.');\n  } finally {\n    hideLoader();\n    refs.loadMoreBtn.disabled = false;\n    isLoading = false;\n  }\n}\n\n// --------- ui helpers ---------\nfunction appendMarkup(hits) {\n  const markup = hits.map(toCard).join('');\n  refs.gallery.insertAdjacentHTML('beforeend', markup);\n  lightbox.refresh();\n}\n\nfunction toCard({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) {\n  return `\n    <li class=\"gallery-item\">\n      <a class=\"gallery-link\" href=\"${largeImageURL}\" rel=\"noopener noreferrer\">\n        <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${escapeHtml(tags || '')}\" loading=\"lazy\" />\n        <p class=\"gallery-descr\">\n          likes: <span class=\"descr-span\">${likes}</span>\n          &nbsp; views: <span class=\"descr-span\">${views}</span>\n          &nbsp; comments: <span class=\"descr-span\">${comments}</span>\n          &nbsp; downloads: <span class=\"descr-span\">${downloads}</span>\n        </p>\n      </a>\n    </li>`;\n}\n\nfunction toast(message) {\n  iziToast.error({\n    message,\n    position: 'topRight',\n    maxWidth: 432,\n    closeOnClick: true,\n  });\n}\n\nfunction showLoader()  { refs.loader.style.display = 'flex'; }\nfunction hideLoader()  { refs.loader.style.display = 'none'; }\nfunction showLoadMore(){ refs.loadMoreBtn.classList.remove('is-hidden'); }\nfunction hideLoadMore(){ refs.loadMoreBtn.classList.add('is-hidden'); }\n\nfunction endOfResults() {\n  hideLoadMore();\n  iziToast.info({\n    message: `We're sorry, but you've reached the end of search results.`,\n    position: 'topRight',\n  });\n}\n\nfunction smoothScrollByCard() {\n  const firstCard = refs.gallery.querySelector('.gallery-item');\n  if (!firstCard) return;\n  const { height } = firstCard.getBoundingClientRect();\n  window.scrollBy({ top: height * 2 + 24, behavior: 'smooth' });\n}\n\n// --------- tiny util ---------\nfunction escapeHtml(str) {\n  return String(str).replace(/[&<>\"']/g, s => ({\n    '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', \"'\": '&#39;',\n  }[s]));\n}"],"names":["refs","PER_PAGE","API_KEY","api","axios","getImages","q","page","data","query","maxPage","isLoading","lightbox","SimpleLightbox","onSearch","onLoadMore","toast","hideLoadMore","showLoader","hits","totalHits","appendMarkup","showLoadMore","err","hideLoader","endOfResults","smoothScrollByCard","markup","toCard","webformatURL","largeImageURL","tags","likes","views","comments","downloads","escapeHtml","message","iziToast","firstCard","height","str","s"],"mappings":"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"}