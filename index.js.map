{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["// src/js/pixabay-api.js\nimport axios from 'axios';\n\nexport const PER_PAGE = 15;\nconst API_KEY = '42030436-f44bf17f2fc4b636ae2b8b7a9';\nconst BASE_URL = 'https://pixabay.com/api/';\n\nexport async function getImagesByQuery(query, page = 1) {\n  const { data } = await axios.get(BASE_URL, {\n    params: {\n      key: API_KEY,\n      q: query,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safesearch: true,\n      per_page: PER_PAGE,\n      page,\n    },\n  });\n  return data; // { total, totalHits, hits: [...] }\n}","// src/js/render-functions.js\nimport SimpleLightbox from 'simplelightbox';\n\nconst galleryEl = document.querySelector('.gallery');\nconst loaderEl = document.querySelector('.loader-container');\nconst loadMoreBtn = document.querySelector('.load-btn'); // ВАЖНО: твой класс\n\nconst lightbox = new SimpleLightbox('.gallery-item a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nexport function createGallery(images) {\n  const markup = images.map(({\n    webformatURL, largeImageURL, tags, likes, views, comments, downloads,\n  }) => `\n    <li class=\"gallery-item\">\n      <a class=\"gallery-link\" href=\"${largeImageURL}\">\n        <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${escapeHtml(tags || '')}\" loading=\"lazy\" />\n        <p class=\"gallery-descr\">\n          Likes: <span class=\"descr-span\">${likes}</span>\n          &nbsp; Views: <span class=\"descr-span\">${views}</span>\n          &nbsp; Comments: <span class=\"descr-span\">${comments}</span>\n          &nbsp; Downloads: <span class=\"descr-span\">${downloads}</span>\n        </p>\n      </a>\n    </li>`).join('');\n\n  galleryEl.insertAdjacentHTML('beforeend', markup);\n  lightbox.refresh();\n}\n\nexport function clearGallery() { galleryEl.innerHTML = ''; }\nexport function showLoader() { loaderEl.style.display = 'flex'; }\nexport function hideLoader() { loaderEl.style.display = 'none'; }\nexport function showLoadMoreButton() { loadMoreBtn.classList.remove('is-hidden'); }\nexport function hideLoadMoreButton() { loadMoreBtn.classList.add('is-hidden'); }\n\nfunction escapeHtml(str){\n  return String(str).replace(/[&<>\"']/g, s => ({\n    '&': '&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":'&#39;'\n  }[s]));\n}","// src/main.js\n\nimport './css/styles.css';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport iziToast from 'izitoast';\nimport { getImagesByQuery, PER_PAGE } from './js/pixabay-api';\nimport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton,\n} from './js/render-functions';\n\nconst refs = {\n  form: document.querySelector('.form'),\n  input: document.querySelector('.form input[name=\"search-text\"]'),\n  gallery: document.querySelector('.gallery'),\n  loadMoreBtn: document.querySelector('.load-btn'),\n  searchBtn: document.querySelector('.search-btn'),\n};\n\n// ---- state ----\nlet currentQuery = '';\nlet page = 1;\nlet totalHits = 0;\nlet loaded = 0;\nlet isLoading = false;\n\n// listeners\nrefs.form.addEventListener('submit', onSubmit);\nrefs.loadMoreBtn.addEventListener('click', onLoadMore);\n\nasync function onSubmit(e) {\n  e.preventDefault();\n\n  const q = refs.input.value.trim();\n  if (!q) return toast(`The search field can't be empty! Please, enter your request!`);\n  if (q.length > 100) return toast('Search query must be 100 characters or less.');\n\n  // reset\n  currentQuery = q;\n  page = 1; totalHits = 0; loaded = 0;\n  clearGallery();\n  hideLoadMoreButton();\n\n  await loadPage();\n\n  if (loaded > 0 && loaded < totalHits) showLoadMoreButton();\n}\n\nasync function onLoadMore() {\n  await loadPage({ smooth: true });\n  if (loaded >= totalHits) {\n    hideLoadMoreButton();\n    iziToast.info({\n      message: `We're sorry, but you've reached the end of search results.`,\n      position: 'topRight',\n    });\n  }\n}\n\nasync function loadPage({ smooth = false } = {}) {\n  if (isLoading) return;\n  isLoading = true;\n\n  showLoader();\n  refs.searchBtn.disabled = true;\n  refs.loadMoreBtn.disabled = true;\n\n  try {\n    const { hits, totalHits: totalFromApi } = await getImagesByQuery(currentQuery, page);\n\n    if (page === 1) totalHits = totalFromApi || 0;\n\n    if (!hits?.length) {\n      if (page === 1) toast(`Sorry, there are no images matching your search query. Please, try again!`);\n      return;\n    }\n\n    createGallery(hits);\n    loaded += hits.length;\n\n    if (smooth) smoothScrollByCard();\n    page += 1;\n\n    if (page === 2) refs.form.reset();\n  } catch (err) {\n    console.error(err);\n    toast('Something went wrong. Please, try again later.');\n  } finally {\n    hideLoader();\n    refs.searchBtn.disabled = false;\n    refs.loadMoreBtn.disabled = false;\n    isLoading = false;\n  }\n}\n\nfunction smoothScrollByCard() {\n  const firstCard = refs.gallery.firstElementChild;\n  if (!firstCard) return;\n  const { height } = firstCard.getBoundingClientRect();\n  window.scrollBy({ top: height * 2, behavior: 'smooth' });\n}\n\nfunction toast(message) {\n  iziToast.show({\n    class: 'error-svg',\n    position: 'topRight',\n    icon: 'error-svg',\n    message,\n    maxWidth: '432',\n    messageColor: '#fff',\n    messageSize: '16px',\n    backgroundColor: '#EF4040',\n    close: false,\n    closeOnClick: true,\n  });\n}"],"names":["PER_PAGE","API_KEY","BASE_URL","getImagesByQuery","query","page","data","axios","galleryEl","loaderEl","loadMoreBtn","lightbox","SimpleLightbox","createGallery","images","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","escapeHtml","clearGallery","showLoader","hideLoader","showLoadMoreButton","hideLoadMoreButton","str","s","refs","currentQuery","totalHits","loaded","isLoading","onSubmit","onLoadMore","e","q","toast","loadPage","iziToast","smooth","hits","totalFromApi","smoothScrollByCard","err","firstCard","height","message"],"mappings":"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"}